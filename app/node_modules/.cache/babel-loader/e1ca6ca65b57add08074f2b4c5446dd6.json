{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kroni\\\\Desktop\\\\RIFF RAFFLE SITE PNSC\\\\Riff-Raffle-Solana-NFT final\\\\app\\\\src\\\\pages\\\\RaffleEndedScreen\\\\index.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { useCallback, useMemo, useRef } from 'react';\nimport { Button, IconButton, Tooltip, Typography } from '@material-ui/core';\nimport { sleep } from '@project-serum/common';\nimport toast from 'react-hot-toast';\nimport { useHistory } from 'react-router';\nimport { ArrowBack, DoubleArrow } from '@material-ui/icons';\nimport { useProgramApis } from '../../hooks/useProgramApis';\nimport { claimPrize as claimPrizeQuery } from '../../lib/actions/claimPrize';\nimport { routes } from '../../router/routes';\nimport Screen from '../../components/layout/Screen';\nimport { expand } from '../../lib/randomnessTools';\nimport EndedRaffleActionSection from './components/EndedRaffleActionsSection';\nimport RaffleInfoSection from '../../components/RaffleInfoSection';\nimport PrizeGalleryEnded from './components/PrizeGalleryEnded';\nimport { PrizeShowcaseEnded } from './components/PrizeShowcaseEnded';\nimport useCommonStyles from '../../assets/styles';\nimport { useStyles } from './styles';\nimport { useViewport } from '../../hooks/useViewport';\nimport { DeviceType } from '../../providers/ViewportProvider';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst RaffleEndedScreen = ({\n  raffle,\n  updateRaffle\n}) => {\n  _s();\n\n  const {\n    device\n  } = useViewport();\n  const classes = { ...useCommonStyles(),\n    ...useStyles({\n      device\n    })\n  };\n  const {\n    push\n  } = useHistory();\n  const {\n    draffleClient\n  } = useProgramApis();\n  const prizeGalleryRef = useRef(null);\n  const entrant = useMemo(() => {\n    if (!draffleClient.provider.wallet.publicKey) return;\n    return raffle === null || raffle === void 0 ? void 0 : raffle.entrants.get(draffleClient.provider.wallet.publicKey.toString());\n  }, [raffle, draffleClient.provider.wallet.publicKey]); // \"Unnecessary\" dependency required due to React not picking up change in publicKey subfield\n  // Each winning ticket index for each prize\n\n  const winningTickets = useMemo(() => {\n    if (!raffle.randomness || !raffle.entrants || raffle.entrants.size === 0) return [];\n    const secret = raffle.randomness;\n    return raffle.prizes.map((_, prizeIndex) => {\n      const rand = expand(secret, prizeIndex);\n      return rand % raffle.totalTickets;\n    });\n  }, [raffle]);\n  const claimPrize = useCallback(async (prizeIndex, ticketIndex) => {\n    try {\n      await claimPrizeQuery(draffleClient, raffle, prizeIndex, ticketIndex);\n      await sleep(500);\n      updateRaffle();\n      toast.success('Prize claimed, check your wallet!');\n    } catch (error) {\n      if (error.msg) {\n        toast.error(`Transaction failed: ${error.msg}`);\n      } else {\n        toast.error('Unexpected error');\n      }\n    }\n  }, [draffleClient, raffle, updateRaffle]);\n  const entrantWinningTickets = useMemo(() => {\n    if (!entrant || !winningTickets) return [];\n    return winningTickets.reduce((acc, ticketIndex, prizeIndex) => {\n      if (entrant === null || entrant === void 0 ? void 0 : entrant.tickets.includes(ticketIndex)) {\n        return [...acc, {\n          prizeIndex,\n          ticketIndex\n        }];\n      } else {\n        return acc;\n      }\n    }, []);\n  }, [entrant, winningTickets]);\n  if (!raffle) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: classes.root,\n    children: [device === DeviceType.Phone ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h1\",\n        children: [`> ${raffle.metadata.name}`, /*#__PURE__*/_jsxDEV(\"span\", {\n          className: classes.raffleSubtitle,\n          children: \"[ended]\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.spacer\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(RaffleInfoSection, {\n        raffle: raffle,\n        userConnected: !!draffleClient.provider.wallet.publicKey,\n        userTickets: entrant === null || entrant === void 0 ? void 0 : entrant.tickets\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.spacer\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.actionSectionContainer,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.actionSection,\n          children: /*#__PURE__*/_jsxDEV(EndedRaffleActionSection, {\n            raffle: raffle,\n            userPubkey: draffleClient.provider.wallet.publicKey,\n            entrant: entrant,\n            entrantWinningTickets: entrantWinningTickets,\n            scrollRef: prizeGalleryRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.spacer\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"overline\",\n        children: \"Results\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(PrizeGalleryEnded, {\n        raffle: raffle,\n        entrantWinningTickets: entrantWinningTickets,\n        winningTickets: winningTickets,\n        claimPrize: claimPrize,\n        scrollRef: prizeGalleryRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.spacer\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.topSection,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.raffleTitle,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: classes.leftTitleSection,\n            children: /*#__PURE__*/_jsxDEV(IconButton, {\n              size: \"medium\",\n              className: classes.backButton,\n              onClick: () => push(routes.RAFFLES),\n              children: /*#__PURE__*/_jsxDEV(ArrowBack, {\n                className: classes.backButtonIcon\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 139,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 134,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 133,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: classes.middleTitleSection,\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"h1\",\n              children: `> ${raffle.metadata.name}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 143,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n              title: raffle.endTimestamp.toString(),\n              placement: \"bottom\",\n              children: /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h1\",\n                className: classes.raffleSubtitle,\n                children: \"[ended]\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 148,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 144,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: classes.rightTitleSection\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.mainContent,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.prizesSection,\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"overline\",\n            children: [\"Prizes\", raffle.prizes.length > 3 && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [' -', /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"text\",\n                disableRipple: true,\n                className: classes.seeAllPrizesButton,\n                onClick: () => {\n                  var _prizeGalleryRef$curr;\n\n                  return (_prizeGalleryRef$curr = prizeGalleryRef.current) === null || _prizeGalleryRef$curr === void 0 ? void 0 : _prizeGalleryRef$curr.scrollIntoView({\n                    behavior: 'smooth',\n                    block: 'start'\n                  });\n                },\n                children: [\"See all \", raffle.prizes.length]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 163,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(PrizeShowcaseEnded, {\n            raffle: raffle,\n            winningTickets: winningTickets\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.detailsSection,\n          children: [/*#__PURE__*/_jsxDEV(RaffleInfoSection, {\n            raffle: raffle,\n            userConnected: !!draffleClient.provider.wallet.publicKey,\n            userTickets: entrant === null || entrant === void 0 ? void 0 : entrant.tickets\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: classes.actionSectionContainer,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: classes.actionSection,\n              children: /*#__PURE__*/_jsxDEV(EndedRaffleActionSection, {\n                raffle: raffle,\n                userPubkey: draffleClient.provider.wallet.publicKey,\n                entrant: entrant,\n                entrantWinningTickets: entrantWinningTickets,\n                scrollRef: prizeGalleryRef\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 192,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 191,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.prizeGallerySection,\n        children: [/*#__PURE__*/_jsxDEV(DoubleArrow, {\n          className: classes.scrollIcon\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(PrizeGalleryEnded, {\n          raffle: raffle,\n          entrantWinningTickets: entrantWinningTickets,\n          winningTickets: winningTickets,\n          claimPrize: claimPrize,\n          scrollRef: prizeGalleryRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.spacer\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 93,\n    columnNumber: 5\n  }, this);\n};\n\n_s(RaffleEndedScreen, \"qUMS1YL0DqbhGougb1ragYWRZzA=\", false, function () {\n  return [useViewport, useCommonStyles, useStyles, useHistory, useProgramApis];\n});\n\n_c = RaffleEndedScreen;\n\nconst RaffleEndedScreenWithLayout = props => {\n  _s2();\n\n  const {\n    push\n  } = useHistory();\n  console.log(\"raffle ended screen\");\n  return /*#__PURE__*/_jsxDEV(Screen, {\n    onBackNavigation: () => push(routes.RAFFLES),\n    children: /*#__PURE__*/_jsxDEV(RaffleEndedScreen, { ...props\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 231,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(RaffleEndedScreenWithLayout, \"SN3rivdM6JynFVqRWZkIPSEILRo=\", false, function () {\n  return [useHistory];\n});\n\n_c2 = RaffleEndedScreenWithLayout;\nexport default RaffleEndedScreenWithLayout;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"RaffleEndedScreen\");\n$RefreshReg$(_c2, \"RaffleEndedScreenWithLayout\");","map":{"version":3,"sources":["C:/Users/kroni/Desktop/RIFF RAFFLE SITE PNSC/Riff-Raffle-Solana-NFT final/app/src/pages/RaffleEndedScreen/index.tsx"],"names":["useCallback","useMemo","useRef","Button","IconButton","Tooltip","Typography","sleep","toast","useHistory","ArrowBack","DoubleArrow","useProgramApis","claimPrize","claimPrizeQuery","routes","Screen","expand","EndedRaffleActionSection","RaffleInfoSection","PrizeGalleryEnded","PrizeShowcaseEnded","useCommonStyles","useStyles","useViewport","DeviceType","RaffleEndedScreen","raffle","updateRaffle","device","classes","push","draffleClient","prizeGalleryRef","entrant","provider","wallet","publicKey","entrants","get","toString","winningTickets","randomness","size","secret","prizes","map","_","prizeIndex","rand","totalTickets","ticketIndex","success","error","msg","entrantWinningTickets","reduce","acc","tickets","includes","root","Phone","metadata","name","raffleSubtitle","spacer","actionSectionContainer","actionSection","topSection","raffleTitle","leftTitleSection","backButton","RAFFLES","backButtonIcon","middleTitleSection","endTimestamp","rightTitleSection","mainContent","prizesSection","length","seeAllPrizesButton","current","scrollIntoView","behavior","block","detailsSection","prizeGallerySection","scrollIcon","RaffleEndedScreenWithLayout","props","console","log"],"mappings":"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","sourcesContent":["import { FC, useCallback, useMemo, useRef } from 'react';\r\nimport { Button, IconButton, Tooltip, Typography } from '@material-ui/core';\r\nimport { sleep } from '@project-serum/common';\r\nimport toast from 'react-hot-toast';\r\nimport { useHistory } from 'react-router';\r\nimport { ArrowBack, DoubleArrow } from '@material-ui/icons';\r\n\r\nimport { useProgramApis } from '../../hooks/useProgramApis';\r\nimport { claimPrize as claimPrizeQuery } from '../../lib/actions/claimPrize';\r\nimport { Raffle } from '../../lib/types';\r\nimport { routes } from '../../router/routes';\r\nimport Screen from '../../components/layout/Screen';\r\nimport { expand } from '../../lib/randomnessTools';\r\nimport EndedRaffleActionSection from './components/EndedRaffleActionsSection';\r\nimport RaffleInfoSection from '../../components/RaffleInfoSection';\r\nimport PrizeGalleryEnded from './components/PrizeGalleryEnded';\r\nimport { PrizeShowcaseEnded } from './components/PrizeShowcaseEnded';\r\nimport useCommonStyles from '../../assets/styles';\r\nimport { useStyles } from './styles';\r\nimport { useViewport } from '../../hooks/useViewport';\r\nimport { DeviceType } from '../../providers/ViewportProvider';\r\n\r\ninterface IRaffleEndedScreenProps {\r\n  raffle: Raffle;\r\n  updateRaffle: () => void;\r\n}\r\n\r\nconst RaffleEndedScreen: FC<IRaffleEndedScreenProps> = ({\r\n  raffle,\r\n  updateRaffle,\r\n}) => {\r\n  const { device } = useViewport();\r\n  const classes = { ...useCommonStyles(), ...(useStyles({ device }) as any) };\r\n  const { push } = useHistory();\r\n  const { draffleClient } = useProgramApis();\r\n\r\n  const prizeGalleryRef = useRef<HTMLDivElement>(null);\r\n\r\n  const entrant = useMemo(() => {\r\n    if (!draffleClient.provider.wallet.publicKey) return;\r\n\r\n    return raffle?.entrants.get(\r\n      draffleClient.provider.wallet.publicKey.toString()\r\n    );\r\n  }, [raffle, draffleClient.provider.wallet.publicKey]); // \"Unnecessary\" dependency required due to React not picking up change in publicKey subfield\r\n\r\n  // Each winning ticket index for each prize\r\n  const winningTickets = useMemo(() => {\r\n    if (!raffle.randomness || !raffle.entrants || raffle.entrants.size === 0)\r\n      return [];\r\n    const secret = raffle.randomness;\r\n    return raffle.prizes.map((_, prizeIndex) => {\r\n      const rand = expand(secret, prizeIndex);\r\n      return rand % raffle.totalTickets;\r\n    });\r\n  }, [raffle]);\r\n\r\n  const claimPrize = useCallback(\r\n    async (prizeIndex: number, ticketIndex: number) => {\r\n      try {\r\n        await claimPrizeQuery(draffleClient, raffle, prizeIndex, ticketIndex);\r\n        await sleep(500);\r\n        updateRaffle();\r\n        toast.success('Prize claimed, check your wallet!');\r\n      } catch (error: any) {\r\n        if (error.msg) {\r\n          toast.error(`Transaction failed: ${error.msg}`);\r\n        } else {\r\n          toast.error('Unexpected error');\r\n        }\r\n      }\r\n    },\r\n    [draffleClient, raffle, updateRaffle]\r\n  );\r\n\r\n  const entrantWinningTickets = useMemo(() => {\r\n    if (!entrant || !winningTickets) return [];\r\n    return winningTickets.reduce<{ prizeIndex: number; ticketIndex: number }[]>(\r\n      (acc, ticketIndex, prizeIndex) => {\r\n        if (entrant?.tickets.includes(ticketIndex)) {\r\n          return [...acc, { prizeIndex, ticketIndex }];\r\n        } else {\r\n          return acc;\r\n        }\r\n      },\r\n      []\r\n    );\r\n  }, [entrant, winningTickets]);\r\n\r\n  if (!raffle) return null;\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      {device === DeviceType.Phone ? (\r\n        <>\r\n          <Typography variant=\"h1\">\r\n            {`> ${raffle.metadata.name}`}\r\n            <span className={classes.raffleSubtitle}>[ended]</span>\r\n          </Typography>\r\n          <div className={classes.spacer} />\r\n          <RaffleInfoSection\r\n            raffle={raffle}\r\n            userConnected={!!draffleClient.provider.wallet.publicKey}\r\n            userTickets={entrant?.tickets}\r\n          />\r\n          <div className={classes.spacer} />\r\n          <div className={classes.actionSectionContainer}>\r\n            <div className={classes.actionSection}>\r\n              <EndedRaffleActionSection\r\n                raffle={raffle}\r\n                userPubkey={draffleClient.provider.wallet.publicKey}\r\n                entrant={entrant}\r\n                entrantWinningTickets={entrantWinningTickets}\r\n                scrollRef={prizeGalleryRef}\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className={classes.spacer} />\r\n          <Typography variant=\"overline\">Results</Typography>\r\n          <PrizeGalleryEnded\r\n            raffle={raffle}\r\n            entrantWinningTickets={entrantWinningTickets}\r\n            winningTickets={winningTickets}\r\n            claimPrize={claimPrize}\r\n            scrollRef={prizeGalleryRef}\r\n          />\r\n          <div className={classes.spacer} />\r\n        </>\r\n      ) : (\r\n        <>\r\n          <div className={classes.topSection}>\r\n            <div className={classes.raffleTitle}>\r\n              <div className={classes.leftTitleSection}>\r\n                <IconButton\r\n                  size=\"medium\"\r\n                  className={classes.backButton}\r\n                  onClick={() => push(routes.RAFFLES)}\r\n                >\r\n                  <ArrowBack className={classes.backButtonIcon} />\r\n                </IconButton>\r\n              </div>\r\n              <div className={classes.middleTitleSection}>\r\n                <Typography variant=\"h1\">{`> ${raffle.metadata.name}`}</Typography>\r\n                <Tooltip\r\n                  title={raffle.endTimestamp.toString()}\r\n                  placement=\"bottom\"\r\n                >\r\n                  <Typography variant=\"h1\" className={classes.raffleSubtitle}>\r\n                    [ended]\r\n                  </Typography>\r\n                </Tooltip>\r\n              </div>\r\n              <div className={classes.rightTitleSection}></div>\r\n            </div>\r\n          </div>\r\n          <div className={classes.mainContent}>\r\n            <div className={classes.prizesSection}>\r\n              <Typography variant=\"overline\">\r\n                Prizes\r\n                {raffle.prizes.length > 3 && (\r\n                  <>\r\n                    {' -'}\r\n                    <Button\r\n                      variant=\"text\"\r\n                      disableRipple\r\n                      className={classes.seeAllPrizesButton}\r\n                      onClick={() =>\r\n                        prizeGalleryRef.current?.scrollIntoView({\r\n                          behavior: 'smooth',\r\n                          block: 'start',\r\n                        })\r\n                      }\r\n                    >\r\n                      See all {raffle.prizes.length}\r\n                    </Button>\r\n                  </>\r\n                )}\r\n              </Typography>\r\n              <PrizeShowcaseEnded\r\n                raffle={raffle}\r\n                winningTickets={winningTickets}\r\n              />\r\n            </div>\r\n            <div className={classes.detailsSection}>\r\n              <RaffleInfoSection\r\n                raffle={raffle}\r\n                userConnected={!!draffleClient.provider.wallet.publicKey}\r\n                userTickets={entrant?.tickets}\r\n              />\r\n              <div className={classes.actionSectionContainer}>\r\n                <div className={classes.actionSection}>\r\n                  <EndedRaffleActionSection\r\n                    raffle={raffle}\r\n                    userPubkey={draffleClient.provider.wallet.publicKey}\r\n                    entrant={entrant}\r\n                    entrantWinningTickets={entrantWinningTickets}\r\n                    scrollRef={prizeGalleryRef}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className={classes.prizeGallerySection}>\r\n            <DoubleArrow className={classes.scrollIcon} />\r\n            <PrizeGalleryEnded\r\n              raffle={raffle}\r\n              entrantWinningTickets={entrantWinningTickets}\r\n              winningTickets={winningTickets}\r\n              claimPrize={claimPrize}\r\n              scrollRef={prizeGalleryRef}\r\n            />\r\n          </div>\r\n        </>\r\n      )}\r\n      <div className={classes.spacer} />\r\n    </div>\r\n  );\r\n};\r\n\r\ninterface IRaffleEndedDetailsProps {\r\n  raffle: Raffle;\r\n  updateRaffle: () => void;\r\n}\r\n\r\nconst RaffleEndedScreenWithLayout: FC<IRaffleEndedDetailsProps> = (props) => {\r\n  const { push } = useHistory();\r\n\r\n  console.log(\"raffle ended screen\")\r\n\r\n  return (\r\n    <Screen onBackNavigation={() => push(routes.RAFFLES)}>\r\n      <RaffleEndedScreen {...props} />\r\n    </Screen>\r\n  );\r\n};\r\n\r\nexport default RaffleEndedScreenWithLayout;\r\n"]},"metadata":{},"sourceType":"module"}