{"ast":null,"code":"import _toConsumableArray from\"C:/Users/kroni/Desktop/RIFF RAFFLE SITE PNSC/Riff-Raffle-Solana-NFT/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/Users/kroni/Desktop/RIFF RAFFLE SITE PNSC/Riff-Raffle-Solana-NFT/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/kroni/Desktop/RIFF RAFFLE SITE PNSC/Riff-Raffle-Solana-NFT/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"C:/Users/kroni/Desktop/RIFF RAFFLE SITE PNSC/Riff-Raffle-Solana-NFT/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{useCallback,useMemo,useRef}from'react';import{Button,IconButton,Tooltip,Typography}from'@material-ui/core';import{sleep}from'@project-serum/common';import toast from'react-hot-toast';import{useHistory}from'react-router';import{ArrowBack,DoubleArrow}from'@material-ui/icons';import{useProgramApis}from'../../hooks/useProgramApis';import{claimPrize as claimPrizeQuery}from'../../lib/actions/claimPrize';import{routes}from'../../router/routes';import Screen from'../../components/layout/Screen';import{expand}from'../../lib/randomnessTools';import EndedRaffleActionSection from'./components/EndedRaffleActionsSection';import RaffleInfoSection from'../../components/RaffleInfoSection';import PrizeGalleryEnded from'./components/PrizeGalleryEnded';import{PrizeShowcaseEnded}from'./components/PrizeShowcaseEnded';import useCommonStyles from'../../assets/styles';import{useStyles}from'./styles';import{useViewport}from'../../hooks/useViewport';import{DeviceType}from'../../providers/ViewportProvider';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var RaffleEndedScreen=function RaffleEndedScreen(_ref){var raffle=_ref.raffle,updateRaffle=_ref.updateRaffle;var _useViewport=useViewport(),device=_useViewport.device;var classes=_objectSpread(_objectSpread({},useCommonStyles()),useStyles({device:device}));var _useHistory=useHistory(),push=_useHistory.push;var _useProgramApis=useProgramApis(),draffleClient=_useProgramApis.draffleClient;var prizeGalleryRef=useRef(null);var entrant=useMemo(function(){if(!draffleClient.provider.wallet.publicKey)return;return raffle===null||raffle===void 0?void 0:raffle.entrants.get(draffleClient.provider.wallet.publicKey.toString());},[raffle,draffleClient.provider.wallet.publicKey]);// \"Unnecessary\" dependency required due to React not picking up change in publicKey subfield\n// Each winning ticket index for each prize\nvar winningTickets=useMemo(function(){if(!raffle.randomness||!raffle.entrants||raffle.entrants.size===0)return[];var secret=raffle.randomness;return raffle.prizes.map(function(_,prizeIndex){var rand=expand(secret,prizeIndex);return rand%raffle.totalTickets;});},[raffle]);var claimPrize=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(prizeIndex,ticketIndex){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return claimPrizeQuery(draffleClient,raffle,prizeIndex,ticketIndex);case 3:_context.next=5;return sleep(500);case 5:updateRaffle();toast.success('Prize claimed, check your wallet!');_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);if(_context.t0.msg){toast.error(\"Transaction failed: \".concat(_context.t0.msg));}else{toast.error('Unexpected error');}case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}(),[draffleClient,raffle,updateRaffle]);var entrantWinningTickets=useMemo(function(){if(!entrant||!winningTickets)return[];return winningTickets.reduce(function(acc,ticketIndex,prizeIndex){if(entrant===null||entrant===void 0?void 0:entrant.tickets.includes(ticketIndex)){return[].concat(_toConsumableArray(acc),[{prizeIndex:prizeIndex,ticketIndex:ticketIndex}]);}else{return acc;}},[]);},[entrant,winningTickets]);if(!raffle)return null;return/*#__PURE__*/_jsxs(\"div\",{className:classes.root,children:[device===DeviceType.Phone?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h1\",children:[\"> \".concat(raffle.metadata.name),/*#__PURE__*/_jsx(\"span\",{className:classes.raffleSubtitle,children:\"[ended]\"})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.spacer}),/*#__PURE__*/_jsx(RaffleInfoSection,{raffle:raffle,userConnected:!!draffleClient.provider.wallet.publicKey,userTickets:entrant===null||entrant===void 0?void 0:entrant.tickets}),/*#__PURE__*/_jsx(\"div\",{className:classes.spacer}),/*#__PURE__*/_jsx(\"div\",{className:classes.actionSectionContainer,children:/*#__PURE__*/_jsx(\"div\",{className:classes.actionSection,children:/*#__PURE__*/_jsx(EndedRaffleActionSection,{raffle:raffle,userPubkey:draffleClient.provider.wallet.publicKey,entrant:entrant,entrantWinningTickets:entrantWinningTickets,scrollRef:prizeGalleryRef})})}),/*#__PURE__*/_jsx(\"div\",{className:classes.spacer}),/*#__PURE__*/_jsx(Typography,{variant:\"overline\",children:\"Results\"}),/*#__PURE__*/_jsx(PrizeGalleryEnded,{raffle:raffle,entrantWinningTickets:entrantWinningTickets,winningTickets:winningTickets,claimPrize:claimPrize,scrollRef:prizeGalleryRef}),/*#__PURE__*/_jsx(\"div\",{className:classes.spacer})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:classes.topSection,children:/*#__PURE__*/_jsxs(\"div\",{className:classes.raffleTitle,children:[/*#__PURE__*/_jsx(\"div\",{className:classes.leftTitleSection,children:/*#__PURE__*/_jsx(IconButton,{size:\"medium\",className:classes.backButton,onClick:function onClick(){return push(routes.RAFFLES);},children:/*#__PURE__*/_jsx(ArrowBack,{className:classes.backButtonIcon})})}),/*#__PURE__*/_jsxs(\"div\",{className:classes.middleTitleSection,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h1\",children:\"> \".concat(raffle.metadata.name)}),/*#__PURE__*/_jsx(Tooltip,{title:raffle.endTimestamp.toString(),placement:\"bottom\",children:/*#__PURE__*/_jsx(Typography,{variant:\"h1\",className:classes.raffleSubtitle,children:\"[ended]\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.rightTitleSection})]})}),/*#__PURE__*/_jsxs(\"div\",{className:classes.mainContent,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.prizesSection,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"overline\",children:[\"Prizes\",raffle.prizes.length>3&&/*#__PURE__*/_jsxs(_Fragment,{children:[' -',/*#__PURE__*/_jsxs(Button,{variant:\"text\",disableRipple:true,className:classes.seeAllPrizesButton,onClick:function onClick(){var _prizeGalleryRef$curr;return(_prizeGalleryRef$curr=prizeGalleryRef.current)===null||_prizeGalleryRef$curr===void 0?void 0:_prizeGalleryRef$curr.scrollIntoView({behavior:'smooth',block:'start'});},children:[\"See all \",raffle.prizes.length]})]})]}),/*#__PURE__*/_jsx(PrizeShowcaseEnded,{raffle:raffle,winningTickets:winningTickets})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.detailsSection,children:[/*#__PURE__*/_jsx(RaffleInfoSection,{raffle:raffle,userConnected:!!draffleClient.provider.wallet.publicKey,userTickets:entrant===null||entrant===void 0?void 0:entrant.tickets}),/*#__PURE__*/_jsx(\"div\",{className:classes.actionSectionContainer,children:/*#__PURE__*/_jsx(\"div\",{className:classes.actionSection,children:/*#__PURE__*/_jsx(EndedRaffleActionSection,{raffle:raffle,userPubkey:draffleClient.provider.wallet.publicKey,entrant:entrant,entrantWinningTickets:entrantWinningTickets,scrollRef:prizeGalleryRef})})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.prizeGallerySection,children:[/*#__PURE__*/_jsx(DoubleArrow,{className:classes.scrollIcon}),/*#__PURE__*/_jsx(PrizeGalleryEnded,{raffle:raffle,entrantWinningTickets:entrantWinningTickets,winningTickets:winningTickets,claimPrize:claimPrize,scrollRef:prizeGalleryRef})]})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.spacer})]});};var RaffleEndedScreenWithLayout=function RaffleEndedScreenWithLayout(props){var _useHistory2=useHistory(),push=_useHistory2.push;console.log(\"raffle ended screen\");return/*#__PURE__*/_jsx(Screen,{onBackNavigation:function onBackNavigation(){return push(routes.RAFFLES);},children:/*#__PURE__*/_jsx(RaffleEndedScreen,_objectSpread({},props))});};export default RaffleEndedScreenWithLayout;","map":null,"metadata":{},"sourceType":"module"}